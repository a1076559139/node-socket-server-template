/**
 * RML模块(Redis Message List) - 基于redis队列的消息服务
 */
'use strict';

const rmlServer = require('./lib/server.js');
const rmlClient = require('./lib/client.js');


/**
 * createServer - 创建rml服务端
 * @param key     - 消息队列键名
 * @param options - Redis连接参数
 * 
 * rml.on('connect', cb) - 连接成功事件
 * rml.on('close', cb)   - 连接关闭事件
 * rml.on('error', cb)   - 监听消息失败事件
 * rml.on('message', cb) - 有消息到来事件
 * rml.listen(num)       - 开始监听消息,仅首次调用有效(num-连续取的消息条数,0-无限条)
 */
exports.createServer = function (key, options) {
	let rml = new rmlServer();
	rml.connect(key, options);
	return rml;
};

/**
 * createClient - 创建rml客户端
 * @param key     - 消息队列键名
 * @param options - Redis连接参数
 * 
 * rml.on('connect', cb) - 连接成功事件
 * rml.on('close', cb)   - 连接关闭事件
 * rml.on('error', cb)   - 发送消息失败事件
 * rml.send(msg)         - 发送消息(msg-消息内容)
 */
exports.createClient = function (key, options) {
	let rml = new rmlClient();
	rml.connect(key, options);
	return rml;
};